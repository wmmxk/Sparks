{"version":"NotebookV1","origId":503877321547988,"name":"GraphFrames-Demo","language":"scala","commands":[{"version":"CommandV1","origId":503877321547990,"guid":"88e2a693-435d-475c-90be-6f40013e6cfd","subtype":"command","commandType":"auto","position":1.0,"command":"%md # GraphFrames Demonstration","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fd5ae35d-458f-4023-8a05-4144c1a3b810"},{"version":"CommandV1","origId":503877321547991,"guid":"41206048-1586-4c22-b0e9-9de8aad8032c","subtype":"command","commandType":"auto","position":2.0,"command":"%md ## What is GraphFrames?\n\n[GraphFrames](http://graphframes.github.io/user-guide.html) is a DataFrame-based API that allows you to analyze graph data (social graphs, network graphs, property graphs, etc.), using the power of the Spark\ncluster. It is the successor to the RDD-based [GraphX](http://spark.apache.org/docs/latest/graphx-programming-guide.html) API. For an introduction to GraphFrames, see [this blog post](https://databricks.com/blog/2016/03/03/introducing-graphframes.html).\n\nThis notebook contains a simple demonstration of just one small part of the GraphFrames API. Hopefully, it'll whet your appetite.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9ad023ba-356f-4177-8c73-8e3d77750325"},{"version":"CommandV1","origId":503877321547992,"guid":"396a5274-dcc4-4fd0-b420-d5bf0dd716ae","subtype":"command","commandType":"auto","position":3.0,"command":"%md An RDD-based GraphX demonstration conceptually similar to this demo, with a detailed explanation, can be found here: <http://ampcamp.berkeley.edu/big-data-mini-course/graph-analytics-with-graphx.html>. This version is based on the new GraphFrames API.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2cbaa8da-ced0-4e89-b62e-2d2d23c129f5"},{"version":"CommandV1","origId":503877321547993,"guid":"c654f824-d4f5-4eee-8c74-bf24a5a66c28","subtype":"command","commandType":"auto","position":4.0,"command":"%md The following example creates a _property graph_. A property graph is a _directed_ graph: Each node, or _vertex_, in the graph \"points\" at another vertex, and the edge represents the relationship between the first node and the second node.\n\nThe image, at the right, shows an example of a property graph. In that example, a portion of a fictitious dating site, there are four people (the vertices), connected by edges that have the following meanings:\n\n* Valentino likes Angelica; he rated her 9 stars.\n* Angelica also gave Valentino 9 stars.\n* Mercedes gave Valentino 8 stars.\n* Anthony doesn't really like Angelica at all; he gave her 0 zeros.\n\n<img src=\"http://i.imgur.com/P8wyWCZ.png\" alt=\"Property Graph Example\" style=\"float: right\"/>\n\nLet's expand on this World's Most Unpopular Dating Site just a little, for our example.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a764a845-8e3a-4104-919a-c2266f3993a7"},{"version":"CommandV1","origId":503877321547994,"guid":"000a7eea-056e-4a0f-98ea-c4bde3b85c79","subtype":"command","commandType":"auto","position":5.0,"command":"%md ## Constructing our graph","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4887fff5-8677-4b07-9123-bd7f79f03036"},{"version":"CommandV1","origId":503877321547995,"guid":"a7fc68a1-fd6b-4f1b-aa9e-fd6b63ec1503","subtype":"command","commandType":"auto","position":6.0,"command":"import org.graphframes._\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.functions._\n\n// These are the people. They will become the vertices. Each person record\n// has three fields.\n//\n// - a unique numeric ID\n// - a name\n// - an age\nval people = Array(\n  (1, \"Angelica\", 23),\n  (2, \"Valentino\", 31),\n  (3, \"Mercedes\", 52),\n  (4, \"Anthony\", 39),\n  (5, \"Roberto\", 45),\n  (6, \"Julia\", 34)\n)\n// This map makes the edge code easier to read.\nval nameToId = people.map { case (id, name, age) => (name, id) }.toMap\n\n// The vertices are the people.\nval vertices = sqlContext.createDataFrame(people).toDF(\"id\", \"name\", \"age\")\n\n// The edges connect the people, and each edge contains the rating that person 1 gave person 2 (0 to 10).\n// The edges use the IDs to identify the vertices.\nval edges = sqlContext.createDataFrame(\n  Array(\n  /* First Person by Index >> related somehow to Second Person by Index, with Attribute Value (which is contextual) */\n    (nameToId(\"Valentino\"), nameToId(\"Angelica\"),  9 /* stars */),\n    (nameToId(\"Valentino\"), nameToId(\"Julia\"),     2),\n    (nameToId(\"Mercedes\"),  nameToId(\"Valentino\"), 8),\n    (nameToId(\"Mercedes\"),  nameToId(\"Roberto\"),   3),\n    (nameToId(\"Anthony\"),   nameToId(\"Angelica\"),  0),\n    (nameToId(\"Roberto\"),   nameToId(\"Mercedes\"),  5),\n    (nameToId(\"Roberto\"),   nameToId(\"Angelica\"),  7),\n    (nameToId(\"Angelica\"),  nameToId(\"Valentino\"), 9),\n    (nameToId(\"Anthony\"),   nameToId(\"Mercedes\"),  1),\n    (nameToId(\"Julia\"),     nameToId(\"Anthony\"),   8),\n    (nameToId(\"Anthony\"),   nameToId(\"Julia\"),    10)\n  )\n)\n.toDF(\"src\", \"dst\", \"stars\")\n\n// The graph is the combination of the vertices and the edges.\nval g = GraphFrame(vertices, edges)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"727b46e5-16ba-47c2-931b-6386d57183bb"},{"version":"CommandV1","origId":503877321547996,"guid":"4a6e4b9d-e82d-4b15-89bc-093fda92d094","subtype":"command","commandType":"auto","position":7.0,"command":"display(g.vertices)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e7a7b8f4-bf78-40ab-86f6-23b4bec0df22"},{"version":"CommandV1","origId":503877321547997,"guid":"a018573f-56d4-4066-9d64-4a1e09adfdf7","subtype":"command","commandType":"auto","position":8.0,"command":"display(g.edges)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3820e35d-b1fb-4cb6-a5a9-c0e4fcaedf9c"},{"version":"CommandV1","origId":503877321547998,"guid":"1c78deb1-a06c-4aa9-bed6-104da677ec66","subtype":"command","commandType":"auto","position":9.0,"command":"%md Let's look at the incoming degree of each vertex, which is the number of edges coming _into_ each node (i.e., the number of people who have rated a particular person)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6db836d5-ecdb-4e7b-847f-9c29a2fdd106"},{"version":"CommandV1","origId":503877321547999,"guid":"15ace02f-c320-4534-9a02-c1bbf02cd274","subtype":"command","commandType":"auto","position":10.0,"command":"display(g.inDegrees) // The incoming degree of the vertices","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"795d6e67-b4a1-4a33-a97d-04243c84932b"},{"version":"CommandV1","origId":503877321548000,"guid":"b6eb7d95-c456-41f9-9c19-a369265ad766","subtype":"command","commandType":"auto","position":11.0,"command":"%md We can make that more readable.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"17cd4d7e-4765-4aa3-bd93-ba55313944d8"},{"version":"CommandV1","origId":503877321548001,"guid":"dae9c7db-901e-4e8b-b301-79091d7ac1d7","subtype":"command","commandType":"auto","position":12.0,"command":"val inDegrees = g.inDegrees\ndisplay(\n  inDegrees.join(vertices, inDegrees(\"id\") === vertices(\"id\"))\n           .select($\"name\", $\"inDegree\".as(\"number of ratings\"))\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ac2fcce4-692a-47ec-86af-49ff636cccad"},{"version":"CommandV1","origId":503877321548002,"guid":"becaf162-ed32-4a18-8c45-447a7bc6270d","subtype":"command","commandType":"auto","position":13.0,"command":"%md Let's do the same with out degrees, i.e., the number of ratings each person has made.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"13cdb69a-8b36-4b22-b747-6ce60c8d466a"},{"version":"CommandV1","origId":503877321548003,"guid":"5dc44996-45dd-4f31-9b50-26a65365079d","subtype":"command","commandType":"auto","position":14.0,"command":"val outDegrees = g.outDegrees\ndisplay(\n  outDegrees.join(vertices, outDegrees(\"id\") === vertices(\"id\"))\n            .select($\"name\", $\"outDegree\".as(\"number of ratings\"))\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1195d354-f9b9-4757-890c-64b71dfb8cc8"},{"version":"CommandV1","origId":503877321548004,"guid":"07f6865a-4f49-498c-b8dc-e607253a7271","subtype":"command","commandType":"auto","position":15.0,"command":"%md `degrees` is just the sum of the input and output degrees for each vertex. Or, to put it another way, it's the number of times each person's ID appears as a vertex.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ac791343-e1db-49c7-9031-2472e13b9c96"},{"version":"CommandV1","origId":503877321548005,"guid":"add5b517-cb37-4772-8cdf-979663fc3c5d","subtype":"command","commandType":"auto","position":16.0,"command":"val degrees = g.degrees\ndisplay(\n  degrees.join(vertices, degrees(\"id\") === vertices(\"id\"))\n         .select($\"name\", $\"degree\".as(\"number of ratings\"))\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"742d6af8-520b-47be-b42a-7b837bfef9b1"},{"version":"CommandV1","origId":503877321548006,"guid":"a8ac7e06-dc97-4ab6-a7a0-e7f7033a2fcd","subtype":"command","commandType":"auto","position":17.0,"command":"%md \n\n## Who likes whom?\n\nWe can visually scan the output to find people who really like each other, but only because the graph is so small. In a larger graph, that would be tedious. So, let's see if we can find a way to process the graph programmatically to find people really like each other. We'll define \"really like\" as two people who have rated each with 8 or more stars.\n\nWe want to find sets of two people, each of whom rated the other at least 8. [GraphFrame motif finding](http://graphframes.github.io/user-guide.html#motif-finding) can help here. GraphFrame\nmotif finding uses a simple string-based Domain-Specific Language (DSL) to express structural queries. For instance, the expression `\"(a)-[e]->(b); (b)-[e2]->(a)\"` will search for pairs of vertices,\n`a` and `b`, that are connected by edges in both directions. As it happens, this is _exactly_ what we want.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"70075766-4af8-4483-8f2a-3a59521f446d"},{"version":"CommandV1","origId":503877321548007,"guid":"ed72594c-7a5d-439e-84fd-28f4408f34d1","subtype":"command","commandType":"auto","position":18.0,"command":"val matchUps = g.find(\"(a)-[ab]->(b); (b)-[ba]->(a)\").filter(($\"ab.stars\" > 7) && ($\"ba.stars\" > 7))\ndisplay(matchUps)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e263be7d-47a6-421d-8623-7d1ddb3217b8"},{"version":"CommandV1","origId":503877321548008,"guid":"8e3126f0-1975-481a-ab27-f339aff40885","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n\nIn that output, we can see, for instance, that Valentino likes Angelica (one row) and Angelica like Valentino (another row). Can we collapse that output down to simple rows of matched pairs?\n\nWe can, using a little DataFrame manipulation.\n\n* Use the `array()` function from `org.apache.spark.sql.functions` to pull the two name columns together into a single array column.\n* Use the `sort_array()` function to sort that array column. Thus, the two rows with `[Valentino, Angelica]`, `[Angelica, Valentino]`, will both end up having the value `[Angelica, Valentino]`.\n* Use `distinct` to sort remove the duplicate rows. That way, we don't end up with two `[Angelica <-> Valentino]` entries.\n\nAll three operations can be performed in one statement:\n\n```\nval finalMatchups = matchUps.select(sort_array(array($\"a.name\", $\"b.name\")).as(\"names\")).distinct\n```\n\nHowever, let's do them one by one, so we can see the transformations.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1fc20ffb-fe0f-455e-a1ae-343b3e11cab1"},{"version":"CommandV1","origId":503877321548009,"guid":"a98af019-211b-47ec-8211-cb8405638b0b","subtype":"command","commandType":"auto","position":20.0,"command":"val df1 = matchUps.select(array($\"a.name\", $\"b.name\").as(\"names\"))\ndisplay(df1)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c16eea64-a23b-46fd-8962-122362e0f40b"},{"version":"CommandV1","origId":503877321548010,"guid":"9d541224-3e04-477d-b891-51afe6d347c8","subtype":"command","commandType":"auto","position":21.0,"command":"val df2 = df1.select(sort_array($\"names\").as(\"names\"))\ndisplay(df2)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3cfc56a4-5d5b-48b2-886c-dcb20e43cd5b"},{"version":"CommandV1","origId":503877321548011,"guid":"fcac95cb-44b1-47b3-a2dc-d5f4653a69f9","subtype":"command","commandType":"auto","position":22.0,"command":"val finalMatchups = df2.distinct()\ndisplay(finalMatchups)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3ce489c5-f245-4c0d-aee8-e5e60cf3a548"},{"version":"CommandV1","origId":503877321548012,"guid":"a5d1040e-8812-49fa-9bb3-ae8f048be8f6","subtype":"command","commandType":"auto","position":23.0,"command":"%md Finally, let's pull the matches back to the driver and print them. To make the types a little easier to manage, let's map the\n`finalMatchUps` DataFrame to a `Dataset[Array[String]]`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"df2ffed1-f985-4d81-bc93-6f0304c8bc49"},{"version":"CommandV1","origId":503877321548013,"guid":"953e095a-0644-492a-8b58-d058ce1c1073","subtype":"command","commandType":"auto","position":24.0,"command":"finalMatchups.as[Array[String]].collect().foreach { case Array(n1, n2) =>\n  println(s\"$n1 and $n2 really like each other.\")\n}","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"92a3157e-7dd2-4a58-baea-140fef9338d9"},{"version":"CommandV1","origId":503877321548014,"guid":"73b96001-0433-422c-8ba2-0b0dc7f2ccd9","subtype":"command","commandType":"auto","position":25.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7ec71cc6-fb4b-4a4e-8118-c69833382c7f"}],"dashboards":[],"guid":"7a8239a2-9d32-4757-9794-bb98638e6b4b","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}