{"version":"NotebookV1","origId":503877321548344,"name":"03-Modern-Spark-DataFrame-Dataset","language":"scala","commands":[{"version":"CommandV1","origId":503877321548346,"guid":"26f5f010-d882-4c68-87ae-5620e7715169","subtype":"command","commandType":"auto","position":1.0,"command":"%md #Modern Spark DataFrame/Dataset: \n##Frequent Questions, Answers, and a Look Behind the Scenes","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3843a760-4c78-4ca3-8b34-8642d0c80811"},{"version":"CommandV1","origId":503877321548347,"guid":"e445526f-f846-493a-bf2c-7b29d9ee3272","subtype":"command","commandType":"auto","position":2.0,"command":"%md ### What is Modern Spark, anyway?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"763269bf-e625-4a13-8be0-058f2ca6739f"},{"version":"CommandV1","origId":503877321548348,"guid":"1f7d6b09-b943-4d05-b9fa-6686d2bf502c","subtype":"command","commandType":"auto","position":3.0,"command":"%md #### What API should I use? Why?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"38afe2c7-a4f9-41f0-8f81-c45512818eb6"},{"version":"CommandV1","origId":503877321548349,"guid":"065f5fbe-8782-492b-9058-d592c720b645","subtype":"command","commandType":"auto","position":4.0,"command":"%md #### tl;dr: Use DataFrame/Dataset!\n\nYou probably hear this a lot ... and yet ...\n\nWhy?\n\nLet's start with simple ease of use -- less work for programmers, and Spark accessibility for non-programmers.\n\nThen we'll look at some more reasons and explore some technical details along the way!","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"49e2366f-df32-4d4c-9b5c-a8202fe09210"},{"version":"CommandV1","origId":503877321548350,"guid":"60ef5842-c365-4633-a59a-0880ac321bc6","subtype":"command","commandType":"auto","position":5.0,"command":"%sh wget http://media.mongodb.org/zips.json","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"212193be-d0a3-4407-a14b-7c3b82047239"},{"version":"CommandV1","origId":503877321548351,"guid":"1b19d607-039f-4f07-8e49-4a65f6578441","subtype":"command","commandType":"auto","position":6.0,"command":"%sh pwd","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9e48d742-efbf-4a8f-b692-5685e0c940fd"},{"version":"CommandV1","origId":503877321548352,"guid":"6ea1f296-6c99-410b-9d2a-15e6e2392314","subtype":"command","commandType":"auto","position":7.0,"command":"sqlContext.read.json(\"file:/databricks/driver/zips.json\").registerTempTable(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"877586ee-8054-4793-95ba-b945132c09dc"},{"version":"CommandV1","origId":503877321548353,"guid":"988554af-2829-4541-b9d3-f795d554b7fb","subtype":"command","commandType":"auto","position":8.0,"command":"spark.read.json(\"file:/databricks/driver/zips.json\").createOrReplaceTempView(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a91942bd-af7b-48c0-a29c-7e2581bf8820"},{"version":"CommandV1","origId":503877321548354,"guid":"2e9c6e2d-cde4-491e-a19d-f55f9da7c8f3","subtype":"command","commandType":"auto","position":9.0,"command":"%sql DESCRIBE zip","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2b537ca7-ee06-45eb-85d4-196171e37e45"},{"version":"CommandV1","origId":503877321548355,"guid":"b12e3825-a6bf-43c4-8493-cf070625a3ff","subtype":"command","commandType":"auto","position":10.0,"command":"spark.table(\"zip\").withColumnRenamed(\"_id\", \"zip\").createOrReplaceTempView(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5bd8c839-87f1-4f93-b58d-9791c47f6cc5"},{"version":"CommandV1","origId":503877321548356,"guid":"393a7dfc-ea47-4e31-9d6a-08d991df1455","subtype":"command","commandType":"auto","position":11.0,"command":"%md What are the most populous cities in Illinois, and how many postcodes do they have?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"61b81743-8ed2-41be-94c3-c90ee9b43cc6"},{"version":"CommandV1","origId":503877321548357,"guid":"71c70518-8d22-457c-aa35-976621bb9765","subtype":"command","commandType":"auto","position":12.0,"command":"%sql SELECT COUNT(zip), SUM(pop), city FROM zip WHERE state = 'IL'\n  GROUP BY city \n  ORDER BY SUM(pop) DESC \n  LIMIT 10","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a21de42d-0cb3-4f8b-acb1-5020da5a0f83"},{"version":"CommandV1","origId":503877321548358,"guid":"eb6851ff-c6c7-42ca-a53e-c49f2ee7ba24","subtype":"command","commandType":"auto","position":13.0,"command":"%md #### How bad can that be with RDDs?\n\n__Well ... let's have a look!__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d9da8ba4-e841-4491-92be-42da2e229757"},{"version":"CommandV1","origId":503877321548359,"guid":"5a405472-ab29-4780-bbdc-f5f6e8a743f5","subtype":"command","commandType":"auto","position":14.0,"command":"dbutils.fs.rm(\"dbfs:/FileStore/zip.csv\", true)\nspark.table(\"zip\").select(\"zip\", \"city\", \"state\", \"pop\").write.format(\"csv\").save(\"dbfs:/FileStore/zip.csv\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1470fcb4-edf6-40ac-87aa-552cfe169713"},{"version":"CommandV1","origId":503877321548360,"guid":"8a6904b4-d777-499c-b414-ecd66fcf039e","subtype":"command","commandType":"auto","position":15.0,"command":"val zipRDD = sc.textFile(\"dbfs:/FileStore/zip.csv\").map(line => {\n  val fields = line.split(\",\")\n  (fields(0), fields(1), fields(2), fields(3).toInt) //zip, city, state, pop\n})\n\nprintln(\"CITY (# POSTCODES , POPULATION)\")\nzipRDD.filter(_._3 == \"IL\")\n  .map(record => (record._2, (1, record._4)))\n  .reduceByKey( (a,b) => (a._1 + b._1, a._2 + b._2) )\n  .sortBy(- _._2._2)\n  .take(10).foreach(println)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c983872c-fdd9-4f4f-9bc4-7463eac42817"},{"version":"CommandV1","origId":503877321548361,"guid":"5384f463-537a-4ff2-be19-94b34c6ebcbe","subtype":"command","commandType":"auto","position":16.0,"command":"%md That's a surprisingly long time for less than 30,000 records.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"62bcaf9e-7faa-4b00-a090-c4e8413971f5"},{"version":"CommandV1","origId":503877321548362,"guid":"de1cef58-2bdf-4745-9a50-73835529d324","subtype":"command","commandType":"auto","position":17.0,"command":"%md ##### Is this the best way to write this query?\n\nIt's reasonable, but ... would Spark fix it if, say, wrote this (worse) version:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2b815091-4cf4-44d6-8b7a-c5bad6b141cb"},{"version":"CommandV1","origId":503877321548363,"guid":"fc95ba29-ee70-46f0-a947-d550300c4a33","subtype":"command","commandType":"auto","position":18.0,"command":"println(\"CITY (# POSTCODES , POPULATION)\")\nzipRDD\n  .map(record => ((record._2, record._3), (1, record._4)))\n  .reduceByKey( (a,b) => (a._1 + b._1, a._2 + b._2) )\n  .sortBy(- _._2._2)\n  .filter(_._1._2 == \"IL\")\n  .take(10).foreach(println)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d3c2313d-fd85-4fec-b033-11289e825c23"},{"version":"CommandV1","origId":503877321548364,"guid":"f88f5416-9ba5-4095-a58b-b333adfcafe6","subtype":"command","commandType":"auto","position":19.0,"command":"%md #### The answer is \"no\" -- let's go take a look at the Job UI ...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"42c1c4d7-b80d-40b8-848f-6890dfb33f3c"},{"version":"CommandV1","origId":503877321548365,"guid":"bf2ad2aa-8bb7-4fc3-bbb9-394ee0d1d8e3","subtype":"command","commandType":"auto","position":20.0,"command":"%md ## ... ok ... on to DataFrame and Dataset details!","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c98a6403-6b3a-4936-9b4f-91e3cc1815fa"},{"version":"CommandV1","origId":503877321548366,"guid":"bca06ead-2b64-4d77-a160-f2f0aa8fd0fd","subtype":"command","commandType":"auto","position":21.0,"command":"%md Let's cache this table ...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1fcaf728-5790-4146-864a-bca7e2a17a0e"},{"version":"CommandV1","origId":503877321548367,"guid":"0df9f48f-d140-41e0-8a1c-2a7d75699028","subtype":"command","commandType":"auto","position":22.0,"command":"%sql CACHE TABLE zip","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"836a7bd1-1323-4506-bf40-b294a761f3a6"},{"version":"CommandV1","origId":503877321548368,"guid":"3f67dec3-7068-4c19-9e0a-9c1f33c3528f","subtype":"command","commandType":"auto","position":23.0,"command":"%md (SQL CACHE TABLE isn't lazy ... to the Storage UI!)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1771b19a-308a-4dcc-a97c-b699872d1904"},{"version":"CommandV1","origId":503877321548369,"guid":"4eeb2bb9-4c65-46b6-ac88-71234c86e712","subtype":"command","commandType":"auto","position":24.0,"command":"%md ### Dataset is just a generalization of DataFrame\n\nSo it's easier to use in even more situations","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9094db7d-0c07-4b67-ba2a-bfca9efb2a17"},{"version":"CommandV1","origId":503877321548370,"guid":"411ffc68-249c-4d17-a2a0-b3b716cea259","subtype":"command","commandType":"auto","position":25.0,"command":"import org.apache.spark.sql._\n\nclassOf[DataFrame] == classOf[Dataset[_]]","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5085f407-62d0-4d9b-8bb5-57f8c2d1edf6"},{"version":"CommandV1","origId":503877321548371,"guid":"90a3c29b-c46a-4cac-91b6-1edf04231348","subtype":"command","commandType":"auto","position":26.0,"command":"%md Dataset strong typing is \"virtual\" -- it's just a view that can be applied when you want it:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9c4d401e-762f-4e07-8716-3a349ea94829"},{"version":"CommandV1","origId":503877321548372,"guid":"32f9147d-9628-4087-9fd4-a9cdff82e22f","subtype":"command","commandType":"auto","position":27.0,"command":"val ds = spark.range(3)\nds.printSchema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"60071387-828e-463b-820a-1c2cdd5a9a71"},{"version":"CommandV1","origId":503877321548373,"guid":"6f1532fe-7ca7-4cdf-b3e5-cce8dd126cdb","subtype":"command","commandType":"auto","position":28.0,"command":"ds.as[String]","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"96884107-e6f2-4ea5-a1d4-cfbde1928e22"},{"version":"CommandV1","origId":503877321548374,"guid":"0a33dd27-666c-4b64-86d7-8424956193bf","subtype":"command","commandType":"auto","position":29.0,"command":"%md Note the Scala type changes ... the underlying schema doesn't. What is \"bigint\"? Underlying types are language-neutral, database-flavored types (think HIVE or SQL).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"87519dfd-cdb6-43cd-80d0-395439c3aa7b"},{"version":"CommandV1","origId":503877321548375,"guid":"2448d1f0-c40b-45ec-aeab-bdc87503aa44","subtype":"command","commandType":"auto","position":30.0,"command":"%md Asking for a Dataframe gets you Rows:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a8aff06b-813b-44b0-83ca-49b7f0dcc36f"},{"version":"CommandV1","origId":503877321548376,"guid":"6535ecd3-69af-4c1c-8882-e7c2893eafd9","subtype":"command","commandType":"auto","position":31.0,"command":"ds.toDF.collect","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"45e6d853-fcff-4e29-b966-ed5696d5aa92"},{"version":"CommandV1","origId":503877321548377,"guid":"a041ea3f-38d5-4772-b86c-3258d5921197","subtype":"command","commandType":"auto","position":32.0,"command":"%md Language-neutral, you say? Interesting...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"58445572-f3e4-4e45-a8c4-f6926da576c8"},{"version":"CommandV1","origId":503877321548378,"guid":"e2156793-5e8d-49f3-9c81-c971965614b0","subtype":"command","commandType":"auto","position":33.0,"command":"ds.createOrReplaceTempView(\"numbers\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d43a80be-e86b-4a26-bf52-ea29ab257b16"},{"version":"CommandV1","origId":503877321548379,"guid":"d5e1045d-6ad1-4bde-a753-ff71f9c38fd0","subtype":"command","commandType":"auto","position":34.0,"command":"%python \n\nspark.table(\"numbers\").printSchema()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b70208d-1b89-43e6-b505-443861029a33"},{"version":"CommandV1","origId":503877321548380,"guid":"4867308c-89f2-421d-a484-42208df0096c","subtype":"command","commandType":"auto","position":35.0,"command":"%python\n\nfor line in spark.table(\"numbers\").collect():\n  print line.id","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e320226f-62f0-44cd-9baa-eefcee0861d0"},{"version":"CommandV1","origId":503877321548381,"guid":"57a3ec4f-686e-4e2d-a79e-92b2c07d19f5","subtype":"command","commandType":"auto","position":36.0,"command":"%md Ok, how would this work with a more complicated type?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8203180c-fce1-42f5-8f43-5620758f5232"},{"version":"CommandV1","origId":503877321548382,"guid":"96853dd5-e445-471c-be15-08b0617ad084","subtype":"command","commandType":"auto","position":37.0,"command":"case class Zip(zip:String, city:String, loc:Array[Double], pop:Long, state:String) {\n  val latChicago = 41.8781136\n  val lonChicago = -87.6297982\n  \n  def nearChicago = {\n    // pretend GIS / business-domain logic:\n    math.sqrt(math.pow(loc(0)-lonChicago, 2) + math.pow(loc(1)-latChicago, 2) ) < 1\n  }\n}\n\nspark.table(\"zip\").as[Zip].first","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"45c4c094-c265-4581-97fe-fa627aa2c801"},{"version":"CommandV1","origId":503877321548383,"guid":"59ef0850-02fb-4be8-8f6c-59830e877cf4","subtype":"command","commandType":"auto","position":38.0,"command":"val ds = spark.table(\"zip\").as[Zip]\nds.first.loc","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8689db4f-7041-41ce-9368-64335030edb6"},{"version":"CommandV1","origId":503877321548384,"guid":"d919254e-5955-48fa-88af-2f9c04af34fc","subtype":"command","commandType":"auto","position":39.0,"command":"// Note: The 'token syntax is Scala's \"symbol\" syntax.\nds.groupBy('state).count.orderBy('state).show","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4e371932-508c-4c9f-a59a-3b25431d308e"},{"version":"CommandV1","origId":503877321548385,"guid":"a5c0fbba-efa2-4b42-8b16-c5a4336ce5eb","subtype":"command","commandType":"auto","position":40.0,"command":"%md \"Complex\" or otherwise restricted business-domain logic can easily be used:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7d2cbcca-93f9-4837-9d50-69a5d76a3b77"},{"version":"CommandV1","origId":503877321548386,"guid":"6e29bcf5-94a2-46fe-b995-f27025ade2c1","subtype":"command","commandType":"auto","position":41.0,"command":"spark.read.json(\"file:///databricks/driver/zips.json\").withColumnRenamed(\"_id\",\"zip\").as[Zip].filter(_.nearChicago).show","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fe24f4eb-9bd5-463d-b9e1-3afc18b7e549"},{"version":"CommandV1","origId":503877321548387,"guid":"c0921b05-182a-4aa8-8b0c-f8648eee7eb7","subtype":"command","commandType":"auto","position":42.0,"command":"%md __Query Optimization__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"59c7eee3-0de5-4e64-9d42-7e0fa61b6a8d"},{"version":"CommandV1","origId":503877321548388,"guid":"b42f50ca-806c-43d5-858c-9c001ff40600","subtype":"command","commandType":"auto","position":43.0,"command":"import org.apache.spark.sql.functions._\n\nds.filter('pop > 10000).select(lower('city)).filter('state === \"RI\").collect.foreach(println)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"24c4e6bd-305a-4bcb-acf0-074990831e2f"},{"version":"CommandV1","origId":503877321548389,"guid":"83d7cfe8-bba5-418a-8a20-972673851cf3","subtype":"command","commandType":"auto","position":44.0,"command":"ds.filter('pop > 10000).select(lower('city)).filter('state === \"RI\").explain(true)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"87180b97-c881-477a-9d9d-d5c5cbe70142"},{"version":"CommandV1","origId":503877321548390,"guid":"526a362d-da25-46f6-a727-b76bd7838763","subtype":"command","commandType":"auto","position":45.0,"command":"spark.read.json(\"file:///databricks/driver/zips.json\").withColumnRenamed(\"_id\",\"zip\").as[Zip].filter(_.nearChicago).explain(true)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"76ed9c20-9028-4c66-809b-f9465f9eba4b"},{"version":"CommandV1","origId":503877321548391,"guid":"2457caca-0885-411b-87c3-40584536315a","subtype":"command","commandType":"auto","position":46.0,"command":"%md __Whole-Stage CodeGen__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f3074836-d078-4c9c-8116-c4aa47dcca96"},{"version":"CommandV1","origId":503877321548392,"guid":"826a5812-3cf2-4f34-80a9-701c6636afa9","subtype":"command","commandType":"auto","position":47.0,"command":"import org.apache.spark.sql.execution.debug._\n\nspark.read.json(\"file:///databricks/driver/zips.json\").withColumnRenamed(\"_id\",\"zip\").as[Zip].filter(_.nearChicago).debugCodegen","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"13858835-e2bb-46da-94de-f1492753dede"},{"version":"CommandV1","origId":503877321548393,"guid":"180a3b08-442b-4e2d-9bc8-bca85b09a3b8","subtype":"command","commandType":"auto","position":48.0,"command":"%md __Hive Integration__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b90b0516-ea04-47c2-8234-25242d5155a5"},{"version":"CommandV1","origId":503877321548394,"guid":"5ec6ee91-6ee3-42f5-b9d6-59da2caacd80","subtype":"command","commandType":"auto","position":49.0,"command":"spark.table(\"zip\").write.saveAsTable(\"hive_zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5d71b65b-519d-4b67-bf79-bff927936ab5"},{"version":"CommandV1","origId":503877321548395,"guid":"e2225f73-ab5d-4ad4-a6a6-2a35c7ff3354","subtype":"command","commandType":"auto","position":50.0,"command":"spark.table(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fdf3a0d2-b7ee-4262-a26a-c0fc0a036ac2"},{"version":"CommandV1","origId":503877321548396,"guid":"b83c3ca4-3cb7-4267-b4de-27e7c8f7ea42","subtype":"command","commandType":"auto","position":51.0,"command":"%md You can configure Spark to use your Hive metastore and warehouse... \n\nWhere is the default Hive warehouse in Databricks?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"327da9ff-b50d-49fc-9dc7-fa9486672633"},{"version":"CommandV1","origId":503877321548397,"guid":"e7824bb8-5fa8-4fc5-9b8c-71bd19e82c38","subtype":"command","commandType":"auto","position":52.0,"command":"display(spark.catalog.listDatabases)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"94c733d7-dda8-448b-a7fb-dd9db15e3d14"},{"version":"CommandV1","origId":503877321548398,"guid":"c40452f1-a1c9-4801-809a-899ac3e1cd2a","subtype":"command","commandType":"auto","position":53.0,"command":"display(dbutils.fs.ls(\"dbfs:/user/hive/warehouse/hive_zip\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"abdeca2b-b27a-44b8-b536-35d200d502c1"},{"version":"CommandV1","origId":503877321548399,"guid":"ac3d3eb6-78ce-49bc-9672-a146b6edb6e4","subtype":"command","commandType":"auto","position":54.0,"command":"%md Nearly all of the new development is focused on Dataframe/Dataset infrastructure, their APIs, and APIs that use them such as:\n* SparkML (aka ML Pipelines) -- http://spark.apache.org/docs/latest/ml-guide.html\n* GraphFrames -- Cool NBA pass analysis demo: https://docs.cloud.databricks.com/docs/latest/sample_applications/index.html#Sample%20Analysis/GraphFrame%20based%20Analysis%20(new)/GSW%20Passing%20Analysis.html\n* Structured Streaming -- *new!*","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f4678cc3-f3ce-4805-87b5-8a0af9694450"},{"version":"CommandV1","origId":503877321548400,"guid":"c44e8f5a-f637-40a0-9c39-304cad905ec7","subtype":"command","commandType":"auto","position":55.0,"command":"%md __Structured Streaming Demo__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"73bf271a-1583-4a1e-bc6b-dbf956be695e"},{"version":"CommandV1","origId":503877321548401,"guid":"d0988546-5dbb-40a2-bcf5-a79c84b871ed","subtype":"command","commandType":"auto","position":56.0,"command":"dbutils.fs.rm(\"/stream/in\", true)\ndbutils.fs.mkdirs(\"/stream/in\")\ndbutils.fs.rm(\"/stream/out\", true)\ndbutils.fs.mkdirs(\"/stream/out\")\ndbutils.fs.rm(\"/stream/ck\", true)\ndbutils.fs.mkdirs(\"/stream/ck\")\n\nimport org.apache.spark.sql.types._\n\nval schema = StructType(StructField(\"lastname\", StringType, false) :: StructField(\"email\", StringType, false) :: StructField(\"hits\", IntegerType, false) :: Nil)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"357004d1-01c7-4ae2-b022-223b832103eb"},{"version":"CommandV1","origId":503877321548402,"guid":"00ff36f3-016d-4ac9-8067-f9ebc213f2e9","subtype":"command","commandType":"auto","position":57.0,"command":"val query = spark.readStream.format(\"json\").schema(schema).load(\"dbfs:/stream/in/\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9e304994-9859-4572-9034-fe7b75c03bd6"},{"version":"CommandV1","origId":503877321548403,"guid":"8d145fc4-16d8-4588-890b-afb6c69c34e2","subtype":"command","commandType":"auto","position":58.0,"command":"import org.apache.spark.sql.functions._\n\nval modifiedData = query.select('lastname, lower('email) as \"email\", current_timestamp() as \"now\", 'hits)\n\nval stream = modifiedData.writeStream.option(\"checkpointLocation\", \"dbfs:/stream/ck/\").start(\"dbfs:/stream/out/\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4eec9b38-0bb3-4347-98ec-64987d366383"},{"version":"CommandV1","origId":503877321548404,"guid":"31010a2c-ea4b-421d-a0ac-8efde78687a4","subtype":"command","commandType":"auto","position":59.0,"command":"%sh echo -e '{\"lastname\":\"Jones\", \"email\":\"Jones@Gmail.com\", \"hits\": 3}\\n{\"lastname\":\"Smith\", \"email\":\"smith@GMAIL.com\", \"hits\": 5}' > /tmp/d1.txt","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3023341d-298b-4c70-8a87-8bb86e22d735"},{"version":"CommandV1","origId":503877321548405,"guid":"35010e5f-6c2f-4771-9615-3333cdb20ff3","subtype":"command","commandType":"auto","position":60.0,"command":"dbutils.fs.mv(\"file:/tmp/d1.txt\", \"dbfs:/stream/in\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bba569bd-d047-4655-b8e8-957171ea6221"},{"version":"CommandV1","origId":503877321548406,"guid":"bf433a45-004e-4211-b5d2-02741f3ba448","subtype":"command","commandType":"auto","position":61.0,"command":"display(spark.read.parquet(\"dbfs:/stream/out\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"887cbeff-2e2c-42e4-baf8-8ccba92da922"},{"version":"CommandV1","origId":503877321548407,"guid":"21e2dd0a-8e00-40de-a194-bbbe6219e971","subtype":"command","commandType":"auto","position":62.0,"command":"display(spark.read.parquet(\"dbfs:/stream/out\").select(\"email\", \"hits\").groupBy(\"email\").sum(\"hits\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"825ccc8c-c4a0-4075-ad40-2de2a74cc294"},{"version":"CommandV1","origId":503877321548408,"guid":"f07a8dfc-0b76-4c15-a310-93d3b7aaac7c","subtype":"command","commandType":"auto","position":63.0,"command":"%sh echo '{\"lastname\":\"Smith\", \"email\":\"smith@GMAIL.com\", \"hits\" : 12}' > /tmp/d2.txt","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"df75c2d6-d60a-46f4-b6ad-7ab3c53f38d3"},{"version":"CommandV1","origId":503877321548409,"guid":"7627e54d-2165-4d3d-9509-c0723b2f1539","subtype":"command","commandType":"auto","position":64.0,"command":"dbutils.fs.mv(\"file:/tmp/d2.txt\", \"dbfs:/stream/in\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7241ab92-0018-4602-b2d6-a480906d63b7"},{"version":"CommandV1","origId":503877321548410,"guid":"8f5c50f4-f39a-40ed-85b8-3f3db9fbe754","subtype":"command","commandType":"auto","position":65.0,"command":"display(spark.read.parquet(\"dbfs:/stream/out\").select(\"email\", \"hits\").groupBy(\"email\").sum(\"hits\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cb295b9f-4b22-4e6f-8167-293d088cce9b"},{"version":"CommandV1","origId":503877321548411,"guid":"55b93b0b-5e62-402c-92ba-dc5679a3a05d","subtype":"command","commandType":"auto","position":66.0,"command":"stream.stop","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d4237489-c0dc-4f1c-86b7-309851820640"},{"version":"CommandV1","origId":503877321548412,"guid":"f289c020-c229-42fa-97cb-13822e34604b","subtype":"command","commandType":"auto","position":67.0,"command":"zipRDD.count()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b46c41c0-a672-47d8-a466-bc9e56ea74c1"}],"dashboards":[],"guid":"95ac3e70-b6e6-4fc9-924e-09dbb55ee719","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}