{"version":"NotebookV1","origId":503877321548609,"name":"RDD-Solution","language":"python","commands":[{"version":"CommandV1","origId":503877321548611,"guid":"f8d755df-a07d-4f72-acb9-a7ec99874c9c","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n# Solutions for RDD Lab (Python)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"566363fe-f804-4bf8-8389-4c33e9b2d66a"},{"version":"CommandV1","origId":503877321548612,"guid":"795d5efb-32a6-412f-935c-2408a0b2ec86","subtype":"command","commandType":"auto","position":2.0,"command":"%md ## Exercise 1","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"500b33bf-bff8-42ef-8408-38974d9c1e36"},{"version":"CommandV1","origId":503877321548613,"guid":"b48041b8-438b-428a-97b5-0fdcb83a6fb0","subtype":"command","commandType":"auto","position":3.0,"command":"CrimeData = namedtuple('CrimeData', ['date_string', 'time_string', 'offense', 'latitude', 'longitude'])\n\ndef map_line(line):\n  cols = line.split(\",\")\n  return CrimeData(date_string=cols[10], time_string=cols[11], offense=cols[6], latitude=cols[7], longitude=cols[8])\n  \ndata_rdd = no_header_rdd.map(map_line)\nprint data_rdd.take(10)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"353e5e32-a0b4-4f15-84b4-c658bae0f7c9"},{"version":"CommandV1","origId":503877321548614,"guid":"6034b287-8dc0-4c96-8142-fcc840d6d0e6","subtype":"command","commandType":"auto","position":4.0,"command":"%md ## Exercise 2","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5ca2326a-2a54-44fe-b7b8-a6b72b335141"},{"version":"CommandV1","origId":503877321548615,"guid":"56159640-6aa0-489b-8952-b98692f95d00","subtype":"command","commandType":"auto","position":5.0,"command":"grouped_by_offense_rdd = data_rdd.groupBy(lambda data: data.offense)\n\n# What does this return? You'll need to know for the next step.\nprint grouped_by_offense_rdd.take(10)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fd07fda5-a850-4182-bb9d-3aab31b50f6e"},{"version":"CommandV1","origId":503877321548616,"guid":"6d4847dc-ea3e-493a-a998-9856a44dafc2","subtype":"command","commandType":"auto","position":6.0,"command":"%md ## Exercise 3","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e745b85d-e44c-479b-976e-a40f818a0d96"},{"version":"CommandV1","origId":503877321548617,"guid":"28611d4a-a105-46c4-8ba2-92b8b9f567af","subtype":"command","commandType":"auto","position":7.0,"command":"# Here's one way to do it:\n\noffense_counts = grouped_by_offense_rdd2.map(lambda g: (g[0], len(g[1]))).collect()\nfor offense, count in offense_counts:\n  print \"{0:30s} {1:d}\".format(offense, count)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4625993d-3ec4-4d3c-b64c-9b72cf9cf7ad"},{"version":"CommandV1","origId":503877321548618,"guid":"4326d3b6-c478-45bb-b577-60f3fd218c28","subtype":"command","commandType":"auto","position":8.0,"command":"# But here's a better way:\n\noffense_counts = cleaned_rdd.map(lambda item: (item.offense, item)).countByKey()\nfor offense, counts in offense_counts.items():\n  print \"{0:30s} {1:d}\".format(offense, counts)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"01813d35-6c04-4031-afc7-c978c54ec00a"},{"version":"CommandV1","origId":503877321548619,"guid":"ec1a09cc-2200-4ad7-af8c-a2f1a9b1adc4","subtype":"command","commandType":"auto","position":9.0,"command":"%md ## Exercise 4","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c1ae65c5-368e-408d-be33-b45b68d81270"},{"version":"CommandV1","origId":503877321548620,"guid":"f9f7ce47-6e35-4a36-9117-dda932959dab","subtype":"command","commandType":"auto","position":10.0,"command":"print base_rdd.getNumPartitions()\nprint grouped_by_offense_rdd2.getNumPartitions()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"402c0504-32fb-4f0c-b455-cdd460a6f374"},{"version":"CommandV1","origId":503877321548621,"guid":"9c7736ae-80ac-48dd-876f-7ecd92fc2bae","subtype":"command","commandType":"auto","position":11.0,"command":"%md ## Exercise 5","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3d680684-f367-49ee-915f-5be31c46a715"},{"version":"CommandV1","origId":503877321548622,"guid":"59bf8942-243b-423b-8a33-9dcbef6da5e8","subtype":"command","commandType":"auto","position":12.0,"command":"# It's okay to cache the base RDD. It's not very large. Proof:\nprint \"Count of lines: {0}\".format(base_rdd.count())\ntotalChars = base_rdd.map(lambda line: len(line)).reduce(lambda a, b: a + b)\nprint \"Count of characters (Unicode): {0}\".format(totalChars)\n\n# They're all about the same size, since we didn't filter any data out. However,\n# since we're mostly working with the `cleaned_rdd`, that's the one to cache.\ncleaned_rdd.cache()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"40844655-7c4a-4306-8645-9cbd3a441d23"},{"version":"CommandV1","origId":503877321548623,"guid":"a4e2fabc-738a-490a-812f-f9629c6d34e3","subtype":"command","commandType":"auto","position":13.0,"command":"%md ## Exercise 6","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d0cac494-8e4c-459a-97eb-2e8cc3fa381f"},{"version":"CommandV1","origId":503877321548624,"guid":"7e455c8c-c569-444d-ab8f-598f5f0eb77c","subtype":"command","commandType":"auto","position":14.0,"command":"result_rdd1 = cleaned_rdd.filter(lambda d: \"homicide\" in d.offense.lower()).map(lambda d: (d.offense, 1)).reduceByKey(lambda a, b: a + b)\n\nfor method, count in result_rdd1.collect():\n  print \"{0} {1:d}\".format(method, count)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d1b31202-6de6-41af-a2b3-1e84e9ced039"},{"version":"CommandV1","origId":503877321548625,"guid":"caeae90a-f0da-4c84-b48a-037274584fc1","subtype":"command","commandType":"auto","position":15.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fee06f88-11f1-4df6-a82a-f9a6b5b7ee02"}],"dashboards":[],"guid":"8e21563b-fa64-4a15-9bcb-dea8973f155a","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}