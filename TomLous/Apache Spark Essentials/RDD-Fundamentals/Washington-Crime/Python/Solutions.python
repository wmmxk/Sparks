{"version":"NotebookV1","origId":503877321548741,"name":"Solutions","language":"python","commands":[{"version":"CommandV1","origId":503877321548743,"guid":"a4f27281-be19-4fac-a287-5e013d5fd12f","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n# Solutions for RDD Lab (Python)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4ea1d8f6-985e-443a-b621-3ebc5e6fb1eb"},{"version":"CommandV1","origId":503877321548744,"guid":"102e4527-b86b-4fa7-ade3-402ebae1b824","subtype":"command","commandType":"auto","position":2.0,"command":"%md ## Exercise 1","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f8f578a2-8a6b-4838-9fad-9314634edf79"},{"version":"CommandV1","origId":503877321548745,"guid":"c1a3d9a4-507d-43b2-919b-121420fff2f8","subtype":"command","commandType":"auto","position":3.0,"command":"CrimeData = namedtuple('CrimeData', ['ccn', 'report_time', 'shift', 'offense', 'method'])\n\ndef map_line(line):\n  columns = line.split(\",\")[:5]\n  return CrimeData(*columns)\n\ndata_rdd = no_header_rdd.map(map_line)\npprint(data_rdd.take(10))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"80473ad2-4925-45cd-8491-4e77e7d661f6"},{"version":"CommandV1","origId":503877321548746,"guid":"d0e82da1-db4a-41af-acfd-c47f16c7c8ea","subtype":"command","commandType":"auto","position":4.0,"command":"%md ## Exercise 2","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c1273779-c2ea-41d8-9b87-21124f1a6c91"},{"version":"CommandV1","origId":503877321548747,"guid":"231d884e-f8fe-4e28-9f1c-e391916240c4","subtype":"command","commandType":"auto","position":5.0,"command":"grouped_by_offense_rdd = data_rdd.groupBy(lambda data: data.offense)\n\n# What does this return? You'll need to know for the next step.\nprint grouped_by_offense_rdd.take(10)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9f62bed4-02b2-4f0b-a350-8935a8936aa7"},{"version":"CommandV1","origId":503877321548748,"guid":"042de6ff-1abc-40d4-96c6-d531ca1f31af","subtype":"command","commandType":"auto","position":6.0,"command":"%md ## Exercise 3","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"24be5c95-04b3-411e-8b8c-5b6450c46a1d"},{"version":"CommandV1","origId":503877321548749,"guid":"7fd639e4-f97b-43a3-9e4c-3bcfd66b2867","subtype":"command","commandType":"auto","position":7.0,"command":"# Here's one way to do it:\n\noffense_counts = grouped_by_offense_rdd.map(lambda g: (g[0], len(g[1]))).collect()\nfor offense, count in offense_counts:\n  print \"{0:30s} {1:d}\".format(offense, count)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b0356843-3a93-432d-bec6-8374ca2139fe"},{"version":"CommandV1","origId":503877321548750,"guid":"d991f033-747a-40c5-9058-9fbd22070279","subtype":"command","commandType":"auto","position":8.0,"command":"# But here's a better way:\n\noffense_counts = data_rdd.map(lambda item: (item.offense, item)).countByKey()\nfor offense, counts in offense_counts.items():\n  print \"{0:30s} {1:d}\".format(offense, counts)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0f5e848b-dce2-4250-becd-d147dfdbb064"},{"version":"CommandV1","origId":503877321548751,"guid":"524e5900-4ef5-4cef-9d12-a62c7dd45aa0","subtype":"command","commandType":"auto","position":9.0,"command":"%md ## Exercise 4","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"58fae34d-03eb-4409-9207-e5745a514dfd"},{"version":"CommandV1","origId":503877321548752,"guid":"56f43e3b-b40d-4ee9-8482-25fb3c53d2f6","subtype":"command","commandType":"auto","position":10.0,"command":"print base_rdd.getNumPartitions()\nprint grouped_by_offense_rdd.getNumPartitions()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c84ecd46-b524-42bf-9a88-e4609bff20b1"},{"version":"CommandV1","origId":503877321548753,"guid":"a3641aa4-a82d-4343-b3f9-e8ccec18babf","subtype":"command","commandType":"auto","position":11.0,"command":"%md ## Exercise 5","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0afc0964-149e-4394-a1d4-4ffa3bbddb32"},{"version":"CommandV1","origId":503877321548754,"guid":"89cd4c64-c8ee-4768-9340-4093cb8895ed","subtype":"command","commandType":"auto","position":12.0,"command":"# It's okay to cache the base RDD. It's not very large. Proof:\nprint \"Count of lines: {0}\".format(base_rdd.count())\ntotalChars = base_rdd.map(lambda line: len(line)).reduce(lambda a, b: a + b)\nprint \"Count of characters (Unicode): {0}\".format(totalChars)\n\n# They're all about the same size, since we didn't filter any data out. However,\n# since we're mostly working with the `data_rdd`, that's the one to cache.\ndata_rdd.cache()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"a5c9aa69-9c30-47d4-98a4-26e49021bd7b"},{"version":"CommandV1","origId":503877321548755,"guid":"c0b432fa-100c-4459-906e-40b9b0c063bb","subtype":"command","commandType":"auto","position":13.0,"command":"%md ## Exercise 6","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"04d37ca4-9f16-448f-8987-a027ec8a2ee2"},{"version":"CommandV1","origId":503877321548756,"guid":"7629eb3b-69cd-4f96-9297-89ccaa769c10","subtype":"command","commandType":"auto","position":14.0,"command":"# SOLUTION\nresult_rdd1 = data_rdd.filter(lambda item: item.offense == 'HOMICIDE')\\\n                      .map(lambda item: (item.method, 1))\\\n                      .reduceByKey(lambda i, j: i + j)\n\nfor method, count in result_rdd1.collect():\n  print \"{0:10s} {1:d}\".format(method, count)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c192cb42-6fad-47be-8ebe-0bcacee50235"},{"version":"CommandV1","origId":503877321548757,"guid":"f3d97555-d2e9-4123-881b-ebc17ad40646","subtype":"command","commandType":"auto","position":15.0,"command":"%md ## Exercise 7","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"36aa9f2d-2f43-45a3-a271-6ca8a9a5e77d"},{"version":"CommandV1","origId":503877321548758,"guid":"90355ea9-2231-420c-92c7-12e20a4e08a2","subtype":"command","commandType":"auto","position":16.0,"command":"# There are quite a few ways to solve this one, but here's a straightforward (and relatively fast) one.\nprint (data_rdd.map(lambda item: (item.shift, 1))\n               .reduceByKey(lambda c1, c2: c1 + c2)\n               .max(key=lambda t: t[1]))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4afeed4f-5cca-487c-8733-c7438d9be4a0"},{"version":"CommandV1","origId":503877321548759,"guid":"d401a886-7c14-4d0a-a1a6-68e262e704ee","subtype":"command","commandType":"auto","position":17.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d3023a5d-1de2-4073-a882-7363d92d8a0b"}],"dashboards":[],"guid":"d57285f8-1b8f-42cd-bc1c-639328a809b5","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}