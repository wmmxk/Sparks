{"version":"NotebookV1","origId":503877321547353,"name":"16-2.0-Overview-Modern-Spark-DataFrame-Dataset","language":"scala","commands":[{"version":"CommandV1","origId":503877321547355,"guid":"dea01e52-9356-4e02-a3bd-13aac734e923","subtype":"command","commandType":"auto","position":1.0,"command":"%md #Modern Spark DataFrame/Dataset: \n##Frequent Questions, Answers, and a Look Behind the Scenes","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3f035444-7276-472e-96ae-f9bded95219a"},{"version":"CommandV1","origId":503877321547356,"guid":"9dc10fae-0b17-4204-b604-a7f14ae324d7","subtype":"command","commandType":"auto","position":2.0,"command":"%md ### What is Modern Spark, anyway?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2b69243e-91ff-4d51-821d-d942263e071b"},{"version":"CommandV1","origId":503877321547357,"guid":"1fbf3db4-b897-4f41-bf02-a8849df51db1","subtype":"command","commandType":"auto","position":3.0,"command":"%md #### What API should I use? Why?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"609ea2f7-f06b-454f-a7f5-0fe55709280c"},{"version":"CommandV1","origId":503877321547358,"guid":"078b4c9e-8713-421b-bcbe-fd83bc4e2ab4","subtype":"command","commandType":"auto","position":4.0,"command":"%md #### tl;dr: Use DataFrame/Dataset!\n\nYou probably hear this a lot ... and yet ...\n\nWhy?\n\nLet's start with simple ease of use -- less work for programmers, and Spark accessibility for non-programmers.\n\nThen we'll look at some more reasons and explore some technical details along the way!","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f5b16da8-6a0b-4bbd-a9dd-06de7002bb9b"},{"version":"CommandV1","origId":503877321547359,"guid":"d56e3de8-407d-40b3-92a5-06424f827069","subtype":"command","commandType":"auto","position":5.0,"command":"%sh wget http://media.mongodb.org/zips.json","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6103c71b-e6bb-424e-9b9e-cb7a7d4c43c2"},{"version":"CommandV1","origId":503877321547360,"guid":"56279cc5-b7a5-48bb-a0fc-037cdd3d843d","subtype":"command","commandType":"auto","position":6.0,"command":"%sh pwd","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"64a21e60-01dd-49c7-b121-e77da4dc6325"},{"version":"CommandV1","origId":503877321547361,"guid":"cab13894-187a-4aed-88c1-1513803526e3","subtype":"command","commandType":"auto","position":7.0,"command":"sqlContext.read.json(\"file:/databricks/driver/zips.json\").registerTempTable(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e695c5ee-4153-4942-8ee3-1fa3b018453d"},{"version":"CommandV1","origId":503877321547362,"guid":"9d71c2a0-1b4f-436e-a2d0-f6e4f1ee42d8","subtype":"command","commandType":"auto","position":8.0,"command":"spark.read.json(\"file:/databricks/driver/zips.json\").createOrReplaceTempView(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6e52ee45-69d9-4402-8255-147d8c66aa25"},{"version":"CommandV1","origId":503877321547363,"guid":"1fcc760c-a06e-42f1-ab96-14520f4f508d","subtype":"command","commandType":"auto","position":9.0,"command":"%sql DESCRIBE zip","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"98e82208-37ad-450f-9e22-75cc2d3ff11d"},{"version":"CommandV1","origId":503877321547364,"guid":"fa9aca12-e9c5-4771-8d8e-10efb3c31c57","subtype":"command","commandType":"auto","position":10.0,"command":"spark.table(\"zip\").withColumnRenamed(\"_id\", \"zip\").createOrReplaceTempView(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e5b63af3-a125-4a3e-9ded-53629eac8112"},{"version":"CommandV1","origId":503877321547365,"guid":"984a1466-590d-47cb-b1e7-04ceff42d8b2","subtype":"command","commandType":"auto","position":11.0,"command":"%md What are the most populous cities in Illinois, and how many postcodes do they have?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5051e99d-b8e0-40a5-9224-784656df7e7c"},{"version":"CommandV1","origId":503877321547366,"guid":"38f1957f-00ca-48fc-bcdf-8e8f76fc2c58","subtype":"command","commandType":"auto","position":12.0,"command":"%sql SELECT COUNT(zip), SUM(pop), city FROM zip WHERE state = 'IL'\n  GROUP BY city \n  ORDER BY SUM(pop) DESC \n  LIMIT 10","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1e461a90-2793-4468-98e0-c7ddfba9a69f"},{"version":"CommandV1","origId":503877321547367,"guid":"ae4e2b92-db04-4bfb-a6f4-95ac485fa77d","subtype":"command","commandType":"auto","position":13.0,"command":"%md #### How bad can that be with RDDs?\n\n__Well ... let's have a look!__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9397ffc6-013b-40ab-b3e0-688601395611"},{"version":"CommandV1","origId":503877321547368,"guid":"2414764f-2459-470e-a8ec-2fc36620e652","subtype":"command","commandType":"auto","position":14.0,"command":"dbutils.fs.rm(\"dbfs:/FileStore/zip.csv\", true)\nspark.table(\"zip\").select(\"zip\", \"city\", \"state\", \"pop\").write.format(\"csv\").save(\"dbfs:/FileStore/zip.csv\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4d30669e-258b-465a-afbb-4121fedb6eb9"},{"version":"CommandV1","origId":503877321547369,"guid":"872ce5fd-59ee-4169-a0d9-ac08380a9972","subtype":"command","commandType":"auto","position":15.0,"command":"val zipRDD = sc.textFile(\"dbfs:/FileStore/zip.csv\").map(line => {\n  val fields = line.split(\",\")\n  (fields(0), fields(1), fields(2), fields(3).toInt) //zip, city, state, pop\n})\n\nprintln(\"CITY (# POSTCODES , POPULATION)\")\nzipRDD.filter(_._3 == \"IL\")\n  .map(record => (record._2, (1, record._4)))\n  .reduceByKey( (a,b) => (a._1 + b._1, a._2 + b._2) )\n  .sortBy(- _._2._2)\n  .take(10).foreach(println)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9caa2b2b-9e76-4ec8-8015-95680be22eb4"},{"version":"CommandV1","origId":503877321547370,"guid":"32638686-a8ee-4c5f-ae54-f1fde6bbc3f7","subtype":"command","commandType":"auto","position":16.0,"command":"%md That's a surprisingly long time for less than 30,000 records.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"aad36f25-d2e6-4178-b472-b590e472212f"},{"version":"CommandV1","origId":503877321547371,"guid":"85056d36-17b7-4d29-94aa-78fc222c29ef","subtype":"command","commandType":"auto","position":17.0,"command":"%md ##### Is this the best way to write this query?\n\nIt's reasonable, but ... would Spark fix it if, say, wrote this (worse) version:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"88dcb9fe-d90c-4dd8-af9d-611e590d5ff6"},{"version":"CommandV1","origId":503877321547372,"guid":"434a3f31-1ea1-4070-bc91-89ef0c5ae453","subtype":"command","commandType":"auto","position":18.0,"command":"println(\"CITY (# POSTCODES , POPULATION)\")\nzipRDD\n  .map(record => ((record._2, record._3), (1, record._4)))\n  .reduceByKey( (a,b) => (a._1 + b._1, a._2 + b._2) )\n  .sortBy(- _._2._2)\n  .filter(_._1._2 == \"IL\")\n  .take(10).foreach(println)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cbe819d9-5f6d-429a-b5c8-3d554e4d48f1"},{"version":"CommandV1","origId":503877321547373,"guid":"e827ab38-ce9c-4c5e-816c-527ecd8186a9","subtype":"command","commandType":"auto","position":19.0,"command":"%md #### The answer is \"no\" -- let's go take a look at the Job UI ...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"09902f81-7be3-4489-89e5-f901fbc5b5b3"},{"version":"CommandV1","origId":503877321547374,"guid":"e30e8b21-86a8-416d-9654-049fbf5036d4","subtype":"command","commandType":"auto","position":20.0,"command":"%md ## ... ok ... on to DataFrame and Dataset details!","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b58de90d-b07d-4cb0-9e08-4307bfa0f43f"},{"version":"CommandV1","origId":503877321547375,"guid":"96dda0cb-2609-438b-a223-3d7f9661ee21","subtype":"command","commandType":"auto","position":21.0,"command":"%md Let's cache this table ...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e94c35ab-d254-4476-904e-8f8548856131"},{"version":"CommandV1","origId":503877321547376,"guid":"d0b67682-6e83-42ad-a7c7-4767e29ed84d","subtype":"command","commandType":"auto","position":22.0,"command":"%sql CACHE TABLE zip","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f5d16257-c9d7-4742-ac18-b553aa8d0ebb"},{"version":"CommandV1","origId":503877321547377,"guid":"d6404928-c038-451e-8981-37fe99463f4c","subtype":"command","commandType":"auto","position":23.0,"command":"%md (SQL CACHE TABLE isn't lazy ... to the Storage UI!)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c5b583d9-cd24-4bb5-a3e6-60179f29318d"},{"version":"CommandV1","origId":503877321547378,"guid":"94049591-cf61-4c1b-a906-bb75bb19fbfe","subtype":"command","commandType":"auto","position":24.0,"command":"%md ### Dataset is just a generalization of DataFrame\n\nSo it's easier to use in even more situations","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4acbf2bf-241a-4c1a-b184-7eaf5e562b3c"},{"version":"CommandV1","origId":503877321547379,"guid":"8969a44c-1b2b-40fb-b496-9e8ad6010beb","subtype":"command","commandType":"auto","position":25.0,"command":"import org.apache.spark.sql._\n\nclassOf[DataFrame] == classOf[Dataset[_]]","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3fa6355d-3426-4107-a0d1-e412e5974522"},{"version":"CommandV1","origId":503877321547380,"guid":"fe64937e-174d-4609-94bd-3d1f3fe52e9f","subtype":"command","commandType":"auto","position":26.0,"command":"%md Dataset strong typing is \"virtual\" -- it's just a view that can be applied when you want it:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3b7ebdf9-eea4-42d1-8556-e0ae2f81e5a1"},{"version":"CommandV1","origId":503877321547381,"guid":"d37d88cd-de02-4472-b13d-78a04a6289f2","subtype":"command","commandType":"auto","position":27.0,"command":"val ds = spark.range(3)\nds.printSchema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ec5f1462-fce4-40e3-b08e-5ceb1e01e37b"},{"version":"CommandV1","origId":503877321547382,"guid":"5869856f-6e4c-4c31-8224-1e54f28b1605","subtype":"command","commandType":"auto","position":28.0,"command":"ds.as[String]","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4aca54de-10df-4948-8def-783000669654"},{"version":"CommandV1","origId":503877321547383,"guid":"3e775322-3d9a-414a-b259-56c40c16fcf3","subtype":"command","commandType":"auto","position":29.0,"command":"%md Note the Scala type changes ... the underlying schema doesn't. What is \"bigint\"? Underlying types are language-neutral, database-flavored types (think HIVE or SQL).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e0ebaaaf-a207-4e94-8515-d66481ce9bad"},{"version":"CommandV1","origId":503877321547384,"guid":"5d12202a-bfbb-4f56-9ce8-f9e6ed5da581","subtype":"command","commandType":"auto","position":30.0,"command":"%md Asking for a Dataframe gets you Rows:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"78d66f5b-7be5-40ef-b7a9-90439ac20a8f"},{"version":"CommandV1","origId":503877321547385,"guid":"bc5dd263-55ad-4b1a-820c-ff22275ed7c4","subtype":"command","commandType":"auto","position":31.0,"command":"ds.toDF.collect","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"fa06e297-9646-4bea-b84f-cd819cc53948"},{"version":"CommandV1","origId":503877321547386,"guid":"5748e171-2731-4295-b365-b9469154c964","subtype":"command","commandType":"auto","position":32.0,"command":"%md Language-neutral, you say? Interesting...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"dc032c28-3bd6-4b7b-8047-df0f8651900b"},{"version":"CommandV1","origId":503877321547387,"guid":"797b31d2-6de8-4974-9e54-da39c3ecee25","subtype":"command","commandType":"auto","position":33.0,"command":"ds.createOrReplaceTempView(\"numbers\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7c8535e5-b355-4720-9370-b8f538d4c057"},{"version":"CommandV1","origId":503877321547388,"guid":"ee0a1c6a-5fec-4b2c-834b-58274869b4d2","subtype":"command","commandType":"auto","position":34.0,"command":"%python \n\nspark.table(\"numbers\").printSchema()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"29b2c8e5-f58e-4082-bcb7-0e524134942e"},{"version":"CommandV1","origId":503877321547389,"guid":"1fa57495-bf12-43d0-ada7-f70f01dfc911","subtype":"command","commandType":"auto","position":35.0,"command":"%python\n\nfor line in spark.table(\"numbers\").collect():\n  print line.id","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1636191d-280b-4057-9329-434b5fc90df3"},{"version":"CommandV1","origId":503877321547390,"guid":"fa1fb8c5-1ae3-47f1-896d-bc029b38b90b","subtype":"command","commandType":"auto","position":36.0,"command":"%md Ok, how would this work with a more complicated type?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"32e809bc-2ac5-4052-bd74-9089a3506845"},{"version":"CommandV1","origId":503877321547391,"guid":"528edeaa-5498-4e95-9e73-ebfad26aaedb","subtype":"command","commandType":"auto","position":37.0,"command":"case class Zip(zip:String, city:String, loc:Array[Double], pop:Long, state:String) {\n  val latChicago = 41.8781136\n  val lonChicago = -87.6297982\n  \n  def nearChicago = {\n    // pretend GIS / business-domain logic:\n    math.sqrt(math.pow(loc(0)-lonChicago, 2) + math.pow(loc(1)-latChicago, 2) ) < 1\n  }\n}\n\nspark.table(\"zip\").as[Zip].first","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4b6576e2-ea19-45f5-a103-eb82a3debd2d"},{"version":"CommandV1","origId":503877321547392,"guid":"9a1278d9-9068-4057-95a5-8c691f327ec4","subtype":"command","commandType":"auto","position":38.0,"command":"val ds = spark.table(\"zip\").as[Zip]\nds.first.loc","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c2b039e9-3d32-4b5a-9eee-0aceb51dc9a2"},{"version":"CommandV1","origId":503877321547393,"guid":"eb5a061e-572a-4455-b497-2c4efeddbb3b","subtype":"command","commandType":"auto","position":39.0,"command":"// Note: The 'token syntax is Scala's \"symbol\" syntax.\nds.groupBy('state).count.orderBy('state).show","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9f84404f-dcf0-4c8d-9627-00611caabe0e"},{"version":"CommandV1","origId":503877321547394,"guid":"b80523f6-df9f-4ef4-bced-83e82dcfe3ce","subtype":"command","commandType":"auto","position":40.0,"command":"%md \"Complex\" or otherwise restricted business-domain logic can easily be used:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f6c1aefd-f648-43f1-bf00-c0e4f041abb3"},{"version":"CommandV1","origId":503877321547395,"guid":"abd89630-6ea9-4ee3-b06c-2f2805a68ce2","subtype":"command","commandType":"auto","position":41.0,"command":"spark.read.json(\"file:///databricks/driver/zips.json\").withColumnRenamed(\"_id\",\"zip\").as[Zip].filter(_.nearChicago).show","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1bad6fcf-2f83-4ee3-94ba-9777279ca925"},{"version":"CommandV1","origId":503877321547396,"guid":"58d7a251-f4a4-4866-9c12-acaf53f4f773","subtype":"command","commandType":"auto","position":42.0,"command":"%md __Query Optimization__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"37186ec6-98c9-4e76-b71d-5ad951ad3f4d"},{"version":"CommandV1","origId":503877321547397,"guid":"8e982067-4c06-439d-9f99-3b2d66ede2c4","subtype":"command","commandType":"auto","position":43.0,"command":"import org.apache.spark.sql.functions._\n\nds.filter('pop > 10000).select(lower('city)).filter('state === \"RI\").collect.foreach(println)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c2f4ccbd-7c71-46e8-8222-e0728ec7f6ee"},{"version":"CommandV1","origId":503877321547398,"guid":"49758f1b-36e6-45a0-a753-5643bfd388a5","subtype":"command","commandType":"auto","position":44.0,"command":"ds.filter('pop > 10000).select(lower('city)).filter('state === \"RI\").explain(true)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9feae83a-e776-4b62-b7d8-81399e55ca19"},{"version":"CommandV1","origId":503877321547399,"guid":"2b318757-280e-4400-be58-e98af564ff2c","subtype":"command","commandType":"auto","position":45.0,"command":"spark.read.json(\"file:///databricks/driver/zips.json\").withColumnRenamed(\"_id\",\"zip\").as[Zip].filter(_.nearChicago).explain(true)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"cdc1a0f8-0af4-49de-bc42-41b1cc06f2b4"},{"version":"CommandV1","origId":503877321547400,"guid":"fbbcd2c1-00b4-4f9a-85b2-528687fb2a3f","subtype":"command","commandType":"auto","position":46.0,"command":"%md __Whole-Stage CodeGen__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"325d177b-39aa-47f1-afd7-2417f5638109"},{"version":"CommandV1","origId":503877321547401,"guid":"5483110e-fe18-462a-a295-9336eda17bd2","subtype":"command","commandType":"auto","position":47.0,"command":"import org.apache.spark.sql.execution.debug._\n\nspark.read.json(\"file:///databricks/driver/zips.json\").withColumnRenamed(\"_id\",\"zip\").as[Zip].filter(_.nearChicago).debugCodegen","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ea865ec2-f616-4115-9199-e694ae02d1f6"},{"version":"CommandV1","origId":503877321547402,"guid":"ee2c433d-898b-4e40-8840-2763004288c5","subtype":"command","commandType":"auto","position":48.0,"command":"%md __Hive Integration__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"32c3a546-81c2-4874-9e0f-c37479dddcb4"},{"version":"CommandV1","origId":503877321547403,"guid":"19447d22-9107-4801-a967-55cb85847172","subtype":"command","commandType":"auto","position":49.0,"command":"spark.table(\"zip\").write.saveAsTable(\"hive_zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d2d39d6b-6228-419c-8765-37d160f15080"},{"version":"CommandV1","origId":503877321547404,"guid":"e7729906-8086-4841-b408-9c1279a2e825","subtype":"command","commandType":"auto","position":50.0,"command":"spark.table(\"zip\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1305d3dd-59d5-43c8-a5ed-c1d7f8a0c0a0"},{"version":"CommandV1","origId":503877321547405,"guid":"482b1743-5d62-4a87-a6d2-d4ef1a79c020","subtype":"command","commandType":"auto","position":51.0,"command":"%md You can configure Spark to use your Hive metastore and warehouse... \n\nWhere is the default Hive warehouse in Databricks?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8e8bc9b7-cb10-43a8-86cb-da23c5c50523"},{"version":"CommandV1","origId":503877321547406,"guid":"626c44ad-ac75-43f4-822e-bca5736267e1","subtype":"command","commandType":"auto","position":52.0,"command":"display(spark.catalog.listDatabases)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"782eccf4-8fcb-4ec0-ab8f-13a40842c68c"},{"version":"CommandV1","origId":503877321547407,"guid":"6d230837-e422-4e7c-880d-282d26862fe2","subtype":"command","commandType":"auto","position":53.0,"command":"display(dbutils.fs.ls(\"dbfs:/user/hive/warehouse/hive_zip\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f971a6aa-c190-4316-a369-13fc5661a49c"},{"version":"CommandV1","origId":503877321547408,"guid":"37a459bf-5cca-4f8e-8101-ba7856a2bbef","subtype":"command","commandType":"auto","position":54.0,"command":"%md Nearly all of the new development is focused on Dataframe/Dataset infrastructure, their APIs, and APIs that use them such as:\n* SparkML (aka ML Pipelines) -- http://spark.apache.org/docs/latest/ml-guide.html\n* GraphFrames -- Cool NBA pass analysis demo: https://docs.cloud.databricks.com/docs/latest/sample_applications/index.html#Sample%20Analysis/GraphFrame%20based%20Analysis%20(new)/GSW%20Passing%20Analysis.html\n* Structured Streaming -- *new!*","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6e28f782-9243-402c-af67-1f3b7e781122"},{"version":"CommandV1","origId":503877321547409,"guid":"7e38f319-a870-4006-95e2-41dc91207024","subtype":"command","commandType":"auto","position":55.0,"command":"%md __Structured Streaming Demo__","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f0977da4-d10f-4644-9a86-1ccfe6b4f572"},{"version":"CommandV1","origId":503877321547410,"guid":"cdab1b41-b278-4af8-9c71-8fd9523bc171","subtype":"command","commandType":"auto","position":56.0,"command":"dbutils.fs.rm(\"/stream/in\", true)\ndbutils.fs.mkdirs(\"/stream/in\")\ndbutils.fs.rm(\"/stream/out\", true)\ndbutils.fs.mkdirs(\"/stream/out\")\ndbutils.fs.rm(\"/stream/ck\", true)\ndbutils.fs.mkdirs(\"/stream/ck\")\n\nimport org.apache.spark.sql.types._\n\nval schema = StructType(StructField(\"lastname\", StringType, false) :: StructField(\"email\", StringType, false) :: StructField(\"hits\", IntegerType, false) :: Nil)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"177f5fac-0b54-4139-bbaa-1ca610dbd02d"},{"version":"CommandV1","origId":503877321547411,"guid":"9ef68239-52e3-4185-92c5-041d2cb95bf6","subtype":"command","commandType":"auto","position":57.0,"command":"val query = spark.readStream.format(\"json\").schema(schema).load(\"dbfs:/stream/in/\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1961eb2a-5bd6-4f82-98a8-e8e1fffe4960"},{"version":"CommandV1","origId":503877321547412,"guid":"46d7abbb-5e3d-41b9-a528-def4a393a5e8","subtype":"command","commandType":"auto","position":58.0,"command":"import org.apache.spark.sql.functions._\n\nval modifiedData = query.select('lastname, lower('email) as \"email\", current_timestamp() as \"now\", 'hits)\n\nval stream = modifiedData.writeStream.option(\"checkpointLocation\", \"dbfs:/stream/ck/\").start(\"dbfs:/stream/out/\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"902df4d8-1f6c-457d-a37a-6009a28bdb32"},{"version":"CommandV1","origId":503877321547413,"guid":"6faaaa76-7ddb-41be-ae40-17ed313cbd9c","subtype":"command","commandType":"auto","position":59.0,"command":"%sh echo -e '{\"lastname\":\"Jones\", \"email\":\"Jones@Gmail.com\", \"hits\": 3}\\n{\"lastname\":\"Smith\", \"email\":\"smith@GMAIL.com\", \"hits\": 5}' > /tmp/d1.txt","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7f1dc2e3-72cc-4988-9382-55782b12e653"},{"version":"CommandV1","origId":503877321547414,"guid":"74051ad4-0330-4331-82e6-45605768d652","subtype":"command","commandType":"auto","position":60.0,"command":"dbutils.fs.mv(\"file:/tmp/d1.txt\", \"dbfs:/stream/in\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"42a52dca-8992-40e9-950b-9b68ccf3e344"},{"version":"CommandV1","origId":503877321547415,"guid":"52fc82b0-a7b3-4efd-afc7-57cdb508b8f0","subtype":"command","commandType":"auto","position":61.0,"command":"display(spark.read.parquet(\"dbfs:/stream/out\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5b50c5d3-dbd9-455f-a213-251b687d4e1e"},{"version":"CommandV1","origId":503877321547416,"guid":"f9775141-0a14-468c-aece-8cf6b5f45c04","subtype":"command","commandType":"auto","position":62.0,"command":"display(spark.read.parquet(\"dbfs:/stream/out\").select(\"email\", \"hits\").groupBy(\"email\").sum(\"hits\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"18cbacfb-e915-4af0-bc76-5a0963aa8edb"},{"version":"CommandV1","origId":503877321547417,"guid":"922dd0f2-28f3-4aa7-b108-4007000b8ac8","subtype":"command","commandType":"auto","position":63.0,"command":"%sh echo '{\"lastname\":\"Smith\", \"email\":\"smith@GMAIL.com\", \"hits\" : 12}' > /tmp/d2.txt","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"bfba2b8b-e46b-4c18-af3d-028552829e31"},{"version":"CommandV1","origId":503877321547418,"guid":"717fa310-8ad0-48c6-b15b-16ba73e87c8d","subtype":"command","commandType":"auto","position":64.0,"command":"dbutils.fs.mv(\"file:/tmp/d2.txt\", \"dbfs:/stream/in\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0b6605fc-e4e0-4734-9703-9f75a94ed2dd"},{"version":"CommandV1","origId":503877321547419,"guid":"c4edd362-bc38-4a09-8784-62f329201d89","subtype":"command","commandType":"auto","position":65.0,"command":"display(spark.read.parquet(\"dbfs:/stream/out\").select(\"email\", \"hits\").groupBy(\"email\").sum(\"hits\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"e118c38e-8bf3-46c4-8cc6-c46f54b93f40"},{"version":"CommandV1","origId":503877321547420,"guid":"997d3f4c-7068-4846-b5e1-f8dc7c99b0f9","subtype":"command","commandType":"auto","position":66.0,"command":"stream.stop","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"ded46873-b22a-4895-9a03-bd3dcf056923"},{"version":"CommandV1","origId":503877321547421,"guid":"660235d3-1d76-49dd-9a62-6ae251feca9f","subtype":"command","commandType":"auto","position":67.0,"command":"zipRDD.count()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"baf4cced-6570-4d24-9911-fafd2bf96bb6"}],"dashboards":[],"guid":"b1605d99-fd13-4518-99b2-0ff1616505a7","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}