{"version":"NotebookV1","origId":503877321546879,"name":"10-DA-Streaming","language":"scala","commands":[{"version":"CommandV1","origId":503877321546881,"guid":"258046a6-a2eb-4204-9957-d8956c9f5626","subtype":"command","commandType":"auto","position":1.0,"command":"%md #![Spark Logo](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark.png)\n\n**Objective:**\nProvess and analize a live data stream\n\n**Time to Complete:**\n15 mins\n\n**Data Source:**\nLive JSON Stream of Wikipedia edits\n\n**Business Questions:**\n\n* Question # 1) How many Edits occur every 15 seconds to the English Wikipedia vs. another language?\n\n**Technical Accomplishments:**\n- Connect to a live TCPI/IP stream\n- Collect the data into a temp table\n- Transform the data so that it suitable for group counts on a per-second basis\n- Graph the data\n- Show the graph on a dashboard","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"67e68c56-809d-4c05-8654-de3d2743aa0e"},{"version":"CommandV1","origId":503877321546882,"guid":"a521906b-3c6c-4f6d-aad8-fe463085371c","subtype":"command","commandType":"auto","position":2.0,"command":"%md #### Q-1: How many Edits occur every 15 seconds to the English Wikipedia vs. another language?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d7f99bf5-6e4d-48b3-9647-a1462f5c6a74"},{"version":"CommandV1","origId":503877321546883,"guid":"d2368540-323c-421c-943c-d7af92d234c9","subtype":"command","commandType":"auto","position":3.0,"command":"import org.apache.spark._\nimport org.apache.spark.storage._\nimport org.apache.spark.streaming._\nimport org.apache.spark.sql.functions._","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"820c9291-c175-4f8e-b3c4-db36ea2e0413"},{"version":"CommandV1","origId":503877321546884,"guid":"de02f163-4c86-40b0-9400-c92878819eb4","subtype":"command","commandType":"auto","position":4.0,"command":"%md We start with the batch interval: 15 seconds\n* It's short enough that we don't get bored\n* It's long enough that we can see something interesting.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f9dda3e3-737e-4a29-bf36-eb10802cc7f5"},{"version":"CommandV1","origId":503877321546885,"guid":"09071e58-4e09-4ed3-822f-8205c4ab9024","subtype":"command","commandType":"auto","position":5.0,"command":"val batchInterval = Seconds(15)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6b49b4f0-f23b-436d-b4a8-9d29ffe85fe7"},{"version":"CommandV1","origId":503877321546886,"guid":"9986b152-d260-4b58-af80-74aebe9d5cfd","subtype":"command","commandType":"auto","position":6.0,"command":"%md Next we need the specific port and IP address of the server that is currently streaming the data we want to consume. This server streams edit data for about 13 different Wikipedia languages. We'll filter the stream later, to get the ones we want.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"08a02d56-32f7-48c9-a496-856ef3d276f3"},{"version":"CommandV1","origId":503877321546887,"guid":"8f71b853-e3fa-43fb-8a16-12c786f7bcb5","subtype":"command","commandType":"auto","position":7.0,"command":"val streamingServerPort = 9002\nval streamingServerHost = \"54.213.33.240\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"29ed11ef-100a-49e9-b891-b32908b692bb"},{"version":"CommandV1","origId":503877321546888,"guid":"5e7b01ec-8a4c-41f1-8cb5-db58bf8e820f","subtype":"command","commandType":"auto","position":8.0,"command":"%md In order to create the `StreamingContext`, we first need reference to the `SparkContext`.\n\nWhen running on Databricks, the SparkContext is already created for us...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"16de3363-823f-457d-a95f-9a47a8daf5e2"},{"version":"CommandV1","origId":503877321546889,"guid":"73e74586-45c9-47eb-82a0-103df6d0ddb4","subtype":"command","commandType":"auto","position":9.0,"command":"sc","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f0ec4fd0-e29f-411a-9d28-737cc3ee3ba0"},{"version":"CommandV1","origId":503877321546890,"guid":"763f2965-da12-46bb-9b4c-672b3da52521","subtype":"command","commandType":"auto","position":10.0,"command":"%md Create a new `StreamingContext`, using the SparkContext and batch interval:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6e6ac02a-3921-4ac9-a23d-653ec2fc1522"},{"version":"CommandV1","origId":503877321546891,"guid":"68762fb3-e2ae-4155-959f-df66175f8a50","subtype":"command","commandType":"auto","position":11.0,"command":"val ssc = new StreamingContext(sc, batchInterval)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"20a8fd78-f830-4939-be10-e6131b5971c6"},{"version":"CommandV1","origId":503877321546892,"guid":"1ea6b615-dcba-4961-bd99-f61a946afe0f","subtype":"command","commandType":"auto","position":12.0,"command":"%md Create the DStreams which will include data for all languages:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c5e0973b-c831-4f88-8f69-aaf6c2dbaee2"},{"version":"CommandV1","origId":503877321546893,"guid":"31ed8bad-528c-4081-b8e0-ba8b1f28d2db","subtype":"command","commandType":"auto","position":13.0,"command":"val baseDSTREAM = ssc.socketTextStream(streamingServerHost, streamingServerPort)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"81ab9f4b-63da-46df-8793-2508d388ca98"},{"version":"CommandV1","origId":503877321546894,"guid":"66690eed-c12e-4416-82f8-de22f205e171","subtype":"command","commandType":"auto","position":14.0,"command":"%md Register a function to parse the incoming JSON data which in turn register a new \"temporary\" table every 15 seconds (our batch interval):","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"90716512-4e44-4e69-afee-0ea4d8fbb04e"},{"version":"CommandV1","origId":503877321546895,"guid":"d1535bb4-5741-4017-904a-b2cc13926245","subtype":"command","commandType":"auto","position":15.0,"command":"baseDSTREAM.foreachRDD { rdd =>\n  if(! rdd.isEmpty) {\n    sqlContext.read.json(rdd).registerTempTable(\"all_edits\")\n  }\n}","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"92113450-448f-464f-88a1-e5d17203410a"},{"version":"CommandV1","origId":503877321546896,"guid":"e28cb21d-cd8b-407c-997d-1e82e303a15f","subtype":"command","commandType":"auto","position":16.0,"command":"%md So that our data is not deleted, configure the `StreamingContext` to remember (or buffer) our data for 1 minute.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7937bfc2-a665-4649-aa3f-08e4c8b11934"},{"version":"CommandV1","origId":503877321546897,"guid":"dd67e632-64d9-40f9-bbb9-581c251c204e","subtype":"command","commandType":"auto","position":17.0,"command":"  ssc.remember(Minutes(1))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"496eb1a9-51ce-4191-b665-be5cf4150a44"},{"version":"CommandV1","origId":503877321546898,"guid":"540496cd-5276-4023-b4c4-ed8b8c4ed5d1","subtype":"command","commandType":"auto","position":18.0,"command":"%md Now that's configured, go ahead and start the `StreamingContext`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1d3dbc49-aee5-484a-9d4d-3527117c6369"},{"version":"CommandV1","origId":503877321546899,"guid":"11f55d02-92ef-4c9d-9bab-1d342d561a17","subtype":"command","commandType":"auto","position":19.0,"command":"ssc.start","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"735a6cd2-a5a7-4048-8475-7916c0dc81d8"},{"version":"CommandV1","origId":503877321546900,"guid":"fac55b2c-28b8-4c1f-826c-6f92cd6e11bf","subtype":"command","commandType":"auto","position":20.0,"command":"%md It will take 15 seconds before the first set of data is available, but once it is, we can view the data by selecting from our temp table:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"b929dfeb-f09b-4dae-a706-c7e995a5ae5f"},{"version":"CommandV1","origId":503877321546901,"guid":"05e593fa-b99e-4d45-9830-f8be07e68055","subtype":"command","commandType":"auto","position":21.0,"command":"%sql SELECT * FROM all_edits","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"d8c7c02e-b40b-4c99-a159-6a4c49c8aa63"},{"version":"CommandV1","origId":503877321546902,"guid":"ebb77b10-3ec9-412a-b964-5f8b081c29de","subtype":"command","commandType":"auto","position":22.0,"command":"%md Let's narrow down the data to the values we actually care about with a custom select.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8741a76f-d37e-4ed0-85f5-cd134561086e"},{"version":"CommandV1","origId":503877321546903,"guid":"ef3b4cbb-aae7-4d6c-9aea-6c8e580e1417","subtype":"command","commandType":"auto","position":23.0,"command":"%sql SELECT timestamp, wikipedia FROM all_edits order by timestamp, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"30c2a1b5-625c-4f6b-a6a4-f7263c06a829"},{"version":"CommandV1","origId":503877321546904,"guid":"4f249b9a-a38a-47cf-97fc-98ecd0e08620","subtype":"command","commandType":"auto","position":24.0,"command":"%md Next we need to clean up our timestamp so that we can group by second not millisecond.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"28af21ad-238b-4931-9737-6dc477f0b919"},{"version":"CommandV1","origId":503877321546905,"guid":"b5f6dc81-5cfa-4050-8b5f-bb3355e48358","subtype":"command","commandType":"auto","position":25.0,"command":"%sql SELECT date_format(timestamp, 'HH:mm:ss') AS time, wikipedia FROM all_edits order by timestamp, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"4c5a2635-f9bb-493f-93ee-f27c1eeacfc5"},{"version":"CommandV1","origId":503877321546906,"guid":"763acf30-5199-4ac3-a32d-388510249159","subtype":"command","commandType":"auto","position":26.0,"command":"%md Now we can group by the second and channel thus allowing us to get a count. Also, since the stream contains many different languages, let's pare it down to just a few, to make the graph a little easier to read. (Feel free to change the languages, if you want.)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"8d39e447-cd53-4424-aaa5-f8c01bf2ec45"},{"version":"CommandV1","origId":503877321546907,"guid":"57cb2e1a-e263-4ef8-9ab0-a19e821d1a89","subtype":"command","commandType":"auto","position":27.0,"command":"%sql SELECT date_format(timestamp, 'HH:mm:ss') AS time, wikipedia, count(*) as total \n       FROM all_edits \n      WHERE wikipedia IN ('en', 'fr', 'de')\n   GROUP BY date_format(timestamp, 'HH:mm:ss'), wikipedia \n   ORDER BY time, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f06fdda5-98e5-4c86-a599-6d2690a47231"},{"version":"CommandV1","origId":503877321546908,"guid":"25573170-4f6c-4ee7-9232-2cf34e3ff16c","subtype":"command","commandType":"auto","position":28.0,"command":"%md Next we can take the graph and move it to a dashboard.\n* Keys: **time**\n* Series grouping: **channel**\n* Values: **total**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"625562b8-27a6-4df1-a5c2-d882cde0e564"},{"version":"CommandV1","origId":503877321546909,"guid":"6fecd9d0-b38f-45c7-a224-861650b8a154","subtype":"command","commandType":"auto","position":29.0,"command":"%md And when we are all done, shut down the `StreamingContext`:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9d9f7305-3155-486e-97c3-c9ca7a2ed536"},{"version":"CommandV1","origId":503877321546910,"guid":"329b0e88-f496-4e2e-8a44-9cec953cebf9","subtype":"command","commandType":"auto","position":30.0,"command":"StreamingContext.getActive.foreach { _.stop(stopSparkContext = false) }","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"30be2eff-1578-4207-92c7-4de82b322838"},{"version":"CommandV1","origId":503877321546911,"guid":"c05e399c-e564-46ca-b1f0-e7fbfc347688","subtype":"command","commandType":"auto","position":31.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"28ed63df-c9e1-4a74-8d6f-ec3de1abcc4b"}],"dashboards":[],"guid":"de3a1f06-5fdf-4c11-9077-10a29359c977","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}