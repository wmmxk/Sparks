{"version":"NotebookV1","origId":503877321546239,"name":"11-DA-Streaming2","language":"scala","commands":[{"version":"CommandV1","origId":503877321546241,"guid":"e0b3575d-cd23-4571-9a89-a8be973e18a1","subtype":"command","commandType":"auto","position":1.0,"command":"%md #![Spark Logo](http://curriculum-release.s3-website-us-west-2.amazonaws.com/wiki-book/general/logo_spark.png)\n\n**Objective:**\nProcess and analyze a live data stream using a sliding window\n\n**Time to Complete:**\n5 mins\n\n**Data Source:**\nLive JSON Stream of Wikipedia edits\n\n**Business Questions:**\n\n* Question # 1) How many edits occur over a 5-minute window to the English Wikipedia vs. another language?\n\n**Technical Accomplishments:**\n- Process streamed with a 5-minute sliding window","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"264ccf16-92ec-4079-9c20-4a376519e206"},{"version":"CommandV1","origId":503877321546242,"guid":"29aec5ae-dc3b-4f33-b307-e3eb41e596af","subtype":"command","commandType":"auto","position":2.0,"command":"%md #### Q-1: How many edits occur over a 2 minute window to the English Wikipedia vs. another language?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3efbb68f-ad88-4bd1-bf46-1d2776fc5bef"},{"version":"CommandV1","origId":503877321546243,"guid":"96f5abd0-3816-4c51-ab6e-823e9b06034c","subtype":"command","commandType":"auto","position":3.0,"command":"import org.apache.spark._\nimport org.apache.spark.storage._\nimport org.apache.spark.streaming._\nimport org.apache.spark.sql.functions._","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"c5112b0f-4dec-4689-b5dd-fafc78e50a63"},{"version":"CommandV1","origId":503877321546244,"guid":"a382234a-72de-4b9c-a3db-540e9607245d","subtype":"command","commandType":"auto","position":4.0,"command":"%md Our final graph will be accurate only to the second so a 1 second batch interval should suffice:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6e24b6df-38ca-4e26-94c4-8dcb31be2e38"},{"version":"CommandV1","origId":503877321546245,"guid":"8a496dab-7bbd-4668-b076-e9fb6e74afee","subtype":"command","commandType":"auto","position":5.0,"command":"val batchInterval = Seconds(1)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"f8cd8b34-a02b-4895-b2f1-2bdcc7ee87aa"},{"version":"CommandV1","origId":503877321546246,"guid":"068405d8-e570-4957-842a-9fd306436276","subtype":"command","commandType":"auto","position":6.0,"command":"%md Next we need the specific port and IP address of the server that is currently streaming the data we want to consume.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0a5ed988-0f5f-4f1e-aaaf-829ff5d4fb0c"},{"version":"CommandV1","origId":503877321546247,"guid":"7624eb1a-6c10-4d50-9c48-bfbae30ba593","subtype":"command","commandType":"auto","position":7.0,"command":"val streamingServerPort = 9002\nval streamingServerHost = \"54.213.33.240\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"24e55f88-dc23-4832-9fb4-153e4b2ada32"},{"version":"CommandV1","origId":503877321546248,"guid":"63384b70-1bb1-4405-bddd-e544569b35d7","subtype":"command","commandType":"auto","position":8.0,"command":"%md In order to create the `StreamingContext`, we first need reference to the `SparkContext`.\n\nWhen running on Databricks, the SparkContext is already created for us...","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"be9583f3-fe59-4a86-b167-933c7de90194"},{"version":"CommandV1","origId":503877321546249,"guid":"ca24f1db-07c7-4458-bb95-4d8e9a260543","subtype":"command","commandType":"auto","position":9.0,"command":"sc","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"143aa47b-efab-42f1-91a2-d66678b4b66b"},{"version":"CommandV1","origId":503877321546250,"guid":"6a0f4bfc-9516-4b8e-b16a-bb381e04dcfe","subtype":"command","commandType":"auto","position":10.0,"command":"%md Create a new `StreamingContext`, using the SparkContext and batch interval:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"2349ff5f-e4c6-4a6c-a058-c48eee134e80"},{"version":"CommandV1","origId":503877321546251,"guid":"8d8c2163-527f-4894-a9b7-35c05f0e4993","subtype":"command","commandType":"auto","position":11.0,"command":"val ssc = new StreamingContext(sc, batchInterval)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"882ebe6f-345a-435f-8982-54ee0f65187b"},{"version":"CommandV1","origId":503877321546252,"guid":"de525767-c9be-4459-85a1-4ec558988539","subtype":"command","commandType":"auto","position":12.0,"command":"%md Create the DStreams which will include data for all languages:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"99c26107-3da4-4c3d-8d6d-fc1b2569cd75"},{"version":"CommandV1","origId":503877321546253,"guid":"ef164761-a8fe-4066-a4e2-6b569b554abe","subtype":"command","commandType":"auto","position":13.0,"command":"val baseDSTREAM = ssc.socketTextStream(streamingServerHost, streamingServerPort)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1ab7f871-3cac-4b2d-bf56-b50f8c75f9d4"},{"version":"CommandV1","origId":503877321546254,"guid":"020a46b2-fe68-40d8-a294-c2ab060b2b39","subtype":"command","commandType":"auto","position":14.0,"command":"%md Register a function to parse the incoming JSON data which in turn register a new \"temporary\" table every 15 seconds (our batch interval):","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7138c9ea-66be-44a5-b7fc-b441977e39a3"},{"version":"CommandV1","origId":503877321546255,"guid":"91b466e3-9b18-41b9-8936-90a6ac7af785","subtype":"command","commandType":"auto","position":15.0,"command":"val windowDuration = Minutes(2)\nbaseDSTREAM.window(windowDuration).transform(_.coalesce(1)).foreachRDD { rdd =>\n  if(! rdd.isEmpty) {\n    sqlContext.read.json(rdd).registerTempTable(\"all_edits\")\n  }\n}","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"40b96dd3-8ce4-4af4-bd59-9942dba18753"},{"version":"CommandV1","origId":503877321546256,"guid":"5d3d4c06-80df-4505-8f5a-0c0019b92f34","subtype":"command","commandType":"auto","position":16.0,"command":"%md You can also run SQL queries on tables defined on streaming data from a different thread (that is, asynchronous to the running StreamingContext). Just make sure that you set the StreamingContext to remember a sufficient amount of streaming data such that the query can run. Otherwise the StreamingContext, which is unaware of the any asynchronous SQL queries, will delete off old streaming data before the query can complete. \n\nFor example, if you want to query the last batch, but your query can take 5 minutes to run, then call `streamingContext.remember(Minutes(5))`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5d45261e-4271-4c46-984f-96c19577f940"},{"version":"CommandV1","origId":503877321546257,"guid":"332ee213-493e-49a3-aed1-3c19c9d1e74f","subtype":"command","commandType":"auto","position":17.0,"command":"  ssc.remember(Minutes(5))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"7e3ccb14-1f38-4535-84e8-e99aa7f78ec1"},{"version":"CommandV1","origId":503877321546258,"guid":"2ae223e5-b3a5-4274-a8cf-31ca6efca523","subtype":"command","commandType":"auto","position":18.0,"command":"%md Now that's configured, go ahead and start the `StreamingContext`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9f69f169-e6ca-4371-ae91-3fc51e659286"},{"version":"CommandV1","origId":503877321546259,"guid":"91d6922c-0dc6-4c13-b1c7-25244817fd4a","subtype":"command","commandType":"auto","position":19.0,"command":"ssc.start","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"99239363-45b5-43ac-b3bb-45bb5c422b0d"},{"version":"CommandV1","origId":503877321546260,"guid":"88406917-6c8f-479b-999b-639a91d0eddd","subtype":"command","commandType":"auto","position":20.0,"command":"%md With our batch interval set to 1 second, we should start seeing data almost immediately.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"acb86848-fbe0-4cf1-a23b-f9fd7d2659f0"},{"version":"CommandV1","origId":503877321546261,"guid":"7bcbe13a-b84d-4a4e-b0a5-60ade01f68e2","subtype":"command","commandType":"auto","position":21.0,"command":"%sql SELECT * FROM all_edits","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"5d96217b-e380-4ce7-9a60-2e95809ae43a"},{"version":"CommandV1","origId":503877321546262,"guid":"2f5b4149-1cd6-4896-89c3-b3bc96aba72f","subtype":"command","commandType":"auto","position":22.0,"command":"%md Let's narrow down the data to the values we actually care about with a custom select.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"06a5165f-9fd6-4e49-81d5-29df42e50aff"},{"version":"CommandV1","origId":503877321546263,"guid":"021b25dd-5dc2-43cb-b32e-30a69883e01f","subtype":"command","commandType":"auto","position":23.0,"command":"%sql SELECT timestamp, wikipedia FROM all_edits order by timestamp, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"3673cbdb-738f-4bab-b102-b08d61f120eb"},{"version":"CommandV1","origId":503877321546264,"guid":"9dea6971-75ea-4a1d-94cf-370c983ad78f","subtype":"command","commandType":"auto","position":24.0,"command":"%md Next we need to clean up our timestamp so that we can group by second not millisecond.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"500e396b-10af-448c-a39e-004afb51a136"},{"version":"CommandV1","origId":503877321546265,"guid":"493337cd-ba84-4744-89a7-1888a4edb2aa","subtype":"command","commandType":"auto","position":25.0,"command":"%sql SELECT date_format(timestamp, 'HH:mm:ss') AS time, wikipedia FROM all_edits order by timestamp, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"769562ef-29df-4c56-b908-b005061ab09c"},{"version":"CommandV1","origId":503877321546266,"guid":"c06283f9-a0dc-49e5-b4b4-40deebb88ca8","subtype":"command","commandType":"auto","position":26.0,"command":"%md Let's winnow the data down to just a few channels, for easier graphing. We'll use the English, German, and French Wikipedias. (Feel free to substitute others and to play around with the graph.)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"9f762309-b1ca-4087-9c13-10b9b357d0c7"},{"version":"CommandV1","origId":503877321546267,"guid":"5a044fed-84fc-4ded-8d7d-c1d09f4c8a9b","subtype":"command","commandType":"auto","position":27.0,"command":"%sql SELECT date_format(timestamp, 'HH:mm:ss') AS time, wikipedia \n       FROM all_edits \n      WHERE wikipedia IN ('en', 'de', 'fr')\n   ORDER BY timestamp, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"26e50da3-b89e-4e2d-ab77-6b96bb1a4d6c"},{"version":"CommandV1","origId":503877321546268,"guid":"9b7a1dd5-9e77-47ac-8dd0-6c48b6cc79e5","subtype":"command","commandType":"auto","position":28.0,"command":"%md Now we can group by the second and channel thus allowing us to get a count:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1098e799-76b7-47d7-8135-2246219c5970"},{"version":"CommandV1","origId":503877321546269,"guid":"170bf862-e75d-4aa1-bb83-5333b9b5b224","subtype":"command","commandType":"auto","position":29.0,"command":"%sql SELECT date_format(timestamp, 'HH:mm:ss') AS time, wikipedia, count(*) AS total \n       FROM all_edits\n      WHERE wikipedia IN ('en', 'de', 'fr')\n   GROUP BY date_format(timestamp, 'HH:mm:ss'), wikipedia \n   ORDER BY time, wikipedia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"1f5822b8-5c26-42b1-974d-fffdcbbe419c"},{"version":"CommandV1","origId":503877321546270,"guid":"43548679-6746-4334-b26b-a85bc8c2344d","subtype":"command","commandType":"auto","position":30.0,"command":"%md Next we can take the graph and move it to a dashboard.\n* Keys: **time**\n* Series grouping: **channel**\n* Values: **total**","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"608e2c2e-b0d7-4bce-97cd-7e6555c71e85"},{"version":"CommandV1","origId":503877321546271,"guid":"b2b26548-a064-4a03-adc9-fd326212327d","subtype":"command","commandType":"auto","position":31.0,"command":"%md And when we are all done, shut down the `StreamingContext`:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"0c3cf940-5d28-4dd1-923b-ce5db312fef1"},{"version":"CommandV1","origId":503877321546272,"guid":"3d03e4bb-0a69-4771-9ee9-34bbd6cfef04","subtype":"command","commandType":"auto","position":32.0,"command":"StreamingContext.getActive.foreach { _.stop(stopSparkContext = false) }","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"073dcc23-067a-4613-a3eb-c4e3b9bc886a"},{"version":"CommandV1","origId":503877321546273,"guid":"4ea447b1-5a28-457d-b5e7-5237442554a7","subtype":"command","commandType":"auto","position":33.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"nuid":"6c0e0683-1662-4232-abdc-c9d66994451a"}],"dashboards":[],"guid":"d29407db-d6da-4852-ac60-5b3a10f52072","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}